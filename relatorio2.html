<div class="relatorio-container">
  <h2>Relat√≥rio 2 - Calibra√ß√£o de Cameras</h2>
  <h3><pre>
  Leonardo Severgnine Maioli - RA: 11201920579
  Ricardo Javurek Rihan - RA: 11201920897
  Tiago Luiz Silva de Araujo Pereira - RA: 11013316

  Laborat√≥rio realizado dias 25 de Junho, relat√≥rio finalizado dia 02 de Julho.
  </pre></h3>
  <h2>Introdu√ß√£o</h2>
  <h2>Introdu√ß√£o</h2>
<p>
  Este relat√≥rio tem como objetivo documentar os procedimentos e an√°lises realizados durante o Laborat√≥rio 2 da disciplina de Vis√£o Computacional, 
  cujo tema central √© a calibra√ß√£o de c√¢meras. A calibra√ß√£o de c√¢meras √© um processo essencial para corrigir distor√ß√µes causadas pelas lentes e para 
  determinar os par√¢metros intr√≠nsecos (como a dist√¢ncia focal, ponto principal e fator de skew) e extr√≠nsecos (posi√ß√£o e orienta√ß√£o da c√¢mera em 
  rela√ß√£o ao mundo 3D). Esses par√¢metros s√£o fundamentais para aplica√ß√µes como reconstru√ß√£o tridimensional, realidade aumentada, navega√ß√£o de rob√¥s 
  e medi√ß√µes precisas em imagens.
</p>
<p>
  O laborat√≥rio foi dividido em quatro partes principais: (A) Realizar um procedimento de calibra√ß√£o de c√¢mera utilizando imagens de exemplo fornecidas, (B) Calibra√ß√£o de uma webcam 
  com imagens capturadas pelos integrantes da equipe, (C) Calibra√ß√£o de uma segunda c√¢mera, fornecida pelo professor, e (D) Corre√ß√£o de distor√ß√µes 
  em imagens utilizando os par√¢metros obtidos na calibra√ß√£o. Al√©m disso, foram explorados os conceitos te√≥ricos que fundamentam a geometria da forma√ß√£o 
  de imagens e a modelagem de distor√ß√µes radiais e tangenciais.
</p>
<p>
  Ao longo deste relat√≥rio, apresentamos os procedimentos adotados em cada etapa, os c√≥digos utilizados com as devidas modifica√ß√µes, os par√¢metros obtidos e uma an√°lise e compara√ß√£o sobre os resultados.
</p>

  <h2>Arquivos base para reproduzir o procedimento:</h2>
  <ul>
    <li><a href="relatorio2/esza019_2025.2__Lab2_calib_v2.pdf" download class="download-link">üìÑ Baixar Roteiro (PDF)</a></li>
    <li><a href="relatorio2/Lab2_arquivos.zip" download class="download-link">üì¶ Baixar C√≥digos Fonte (ZIP)</a></li>
  </ul>

  <h2>Procedimentos Experimentais</h2>

  <h3>Parte A ‚Äì Calibra√ß√£o com imagens fornecidas</h3>

  <p>
    Nesta primeira etapa do experimento, realizamos um procedimento de calibra√ß√£o da c√¢meras utilizando um conjunto de imagens previamente disponibilizadas. 
    As imagens retratam um padr√£o de tabuleiro de xadrez com dimens√µes <strong>6x9</strong> (n√∫mero de cantos internos), registradas sob diferentes √¢ngulos e posi√ß√µes. 
    O objetivo desta etapa √© estimar os par√¢metros intr√≠nsecos e extr√≠nsecos da c√¢mera utilizada na captura dessas imagens, bem como os coeficientes de distor√ß√£o da lente, 
    com base nas imagens fornecidas.
  </p>

  <div class="image-container">
    <img src="relatorio2/foto1.jpg" alt="Imagem do tabuleiro disponibilizada" class="relatorio-image">
    <p class="image-caption"><em>Exemplo de imagem do tabuleiro disponibilizada para a calibra√ß√£o</em></p>
  </div>
  <p>
    Utilizamos o c√≥digo <code>L2_cal.py</code>, fornecido pelo professor e baseado no tutorial do site 
    <a href="https://learnopencv.com/camera-calibration-using-opencv/" target="_blank">LearnOpenCV</a>. Esse script realiza a leitura das imagens,
    detecta automaticamente os cantos internos do padr√£o de calibra√ß√£o e aplica o algoritmo de calibra√ß√£o de c√¢mera do OpenCV. Inicialmente, com o c√≥digo original, era poss√≠vel detectar apenas um grid 6X8, com dist√¢ncias definadas em 3cm, isso por que, dentro do c√≥digo, foi 
    definido que ele encontrasse um grid nessas especifica√ß√µes. Para que o padr√£o completo fosse detectado corretamente, foi necess√°rio modificar o par√¢metro <code>CHECKERBOARD</code> de <code>(6, 8)</code> para <code>(6, 9)</code>, 
    conforme a geometria do tabuleiro.
  </p>

  <div class="image-container">
    <img src="relatorio2/foto2.jpg" alt="Detec√ß√£o dos cantos do tabuleiro" class="relatorio-image">
    <p class="image-caption"><em>Detec√ß√£o dos cantos internos do padr√£o de calibra√ß√£o</em></p>
  </div>
  
  <p>Trecho do c√≥digo modificado:</p>
<div class="button-group">
  <button onclick="toggleSection('code1')">C√≥digo 1 Modificado</button>
</div>
<div id="code1" class="relatorio-section" style="display: none;">
  <code><pre>
  .....
      import glob
 
      # Defining the dimensions of checkerboard
      CHECKERBOARD = (6,9)
      criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, 30, 0.001)
      
      # Creating vector to store vectors of 3D points for each checkerboard image
      objpoints = []
      .....
  </pre></code>
</div>
  
  <h2>Par√¢metros Obtidos</h2>

  <div style="margin: 20px 0;">
    <div style="font-weight: bold; font-size: 18px; margin-bottom: 10px;">Matriz Intr√≠nseca K</div>
    <p>
      A matriz intr√≠nseca representa os par√¢metros √≥pticos internos da c√¢mera. Ela inclui as dist√¢ncias focais nos eixos x e y (em pixels), 
      a coordenada do ponto principal (centro √≥ptico da imagem) e o fator de skew (geralmente zero em c√¢meras modernas). Essa matrix transforma coordenadas 3D do sistema de coordenadas da c√¢mera em coordenadas 2D na imagem e √© constante para uma determinada c√¢mera e configura√ß√£o de lente.
    </p>
    <table style="border-collapse: collapse;">
      <tr>
        <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">536.0734</td>
        <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">0</td>
        <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">342.3704</td>
      </tr>
      <tr>
        <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">0</td>
        <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">536.0164</td>
        <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">235.5369</td>
      </tr>
      <tr>
        <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">0</td>
        <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">0</td>
        <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">1</td>
      </tr>
    </table>
  </div>


  <h3>Coeficientes de Distor√ß√£o (vetor <code>dist</code>)</h3>
  <p>
    O vetor de distor√ß√£o modela as imperfei√ß√µes da lente, principalmente a <strong>distor√ß√£o radial</strong> (as linhas retas se curvando) e a 
    <strong>distor√ß√£o tangencial</strong> (deslocamentos causados por desalinhamento da lente).
  </p>
  <p><strong>D =</strong> [‚àí0.2651, ‚àí0.0467, 0.0018, ‚àí0.0003, 0.2523]</p>

  <h3>Par√¢metros Extr√≠nsecos (R e t)</h3>
  <p>
    Para cada imagem utilizada na calibra√ß√£o, s√£o obtidos um vetor de rota√ß√£o (<code>rvec</code>) e um vetor de transla√ß√£o (<code>tvec</code>), que juntos definem a posi√ß√£o e 
    orienta√ß√£o da c√¢mera em rela√ß√£o ao plano do tabuleiro. 

        R: traz informa√ß√µes sobre como a c√¢mera est√° rotacionada em rela√ß√£o ao padr√£o de calibra√ß√£o.

        t: traz informa√ß√µes sobre onde a c√¢mera est√° localizada em rela√ß√£o ao padr√£o de calibra√ß√£o.

        Variam para cada imagem, pois dependem da posi√ß√£o relativa entre c√¢mera e tabuleiro
  </p>
  <p>
    Abaixo, apresentamos os primeiros vetores de rota√ß√£o e transla√ß√£o obtidos para as imagens utilizadas:
  </p>

  <div class="button-group">
    <button onclick="toggleSection('extrinsecos')">Mostrar par√¢metros extr√≠nsecos (R e t)</button>
  </div>
  <div id="extrinsecos" class="relatorio-section" style="display: none;">
    <code><pre>
    rvecs (exemplo):
    [-0.08398745], [0.34802803], [-1.54244125]
    [-0.27527337], [0.10123358], [-1.56296566]

    tvecs (exemplo):
    [-2.96218135], [0.57159005], [16.83013788]
    [-3.99387879], [2.27704403], [12.68878153]
    </pre></code>
  </div>

  <p>
    Esses par√¢metros s√£o fundamentais para realizar transforma√ß√µes entre o sistema de coordenadas do mundo real (onde est√° o tabuleiro) 
    e o sistema de coordenadas da c√¢mera. Com isso, √© poss√≠vel reconstruir posi√ß√µes 3D, realizar medi√ß√µes e corrigir distor√ß√µes nas imagens.
  </p>

  
  <h3>Parte B ‚Äì Calibra√ß√£o com webcam do laborat√≥rio</h3>

  <p>
    Na segunda etapa do experimento, realizamos a calibra√ß√£o de uma webcam utilizando imagens capturadas pelos integrantes da equipe. 
    Utilizamos novamente um padr√£o de tabuleiro de xadrez com dimens√µes internas de <strong>6x9</strong> e o script <code>L2_chess.py</code> para capturar de 10 a 15 imagens 
    sob diferentes √¢ngulos e dist√¢ncias. Conforme solicitado, modificamos o nome do arquivo salvo para incluir o nome de um dos integrantes da equipe.
  </p>

  <div class="button-group">
    <button onclick="toggleSection('code2')">C√≥digo 2 Modificado</button>
  </div>
  <div id="code2" class="relatorio-section" style="display: none;">
    <code><pre>
  i = 0
  while True:
      ret, frame = cap.read()
      if not ret:
          print("Can't receive frame (stream end?). Exiting ...")
          break

      cv.imshow('frame', frame)
      k = cv.waitKey(1)

      if k == ord('s'):
          cv.imwrite("Ricardo" + str(i) + ".jpg", frame)
          i += 1
          print("frame", i)
      elif k == ord('q'):
          break
    </pre></code>
  </div>

  <div class="image-container">
    <img src="relatorio2/Ricardo6.jpg" alt="Imagem capturada pela equipe para calibra√ß√£o" class="relatorio-image">
    <p class="image-caption"><em>Exemplo de imagem capturada pela equipe para calibra√ß√£o</em></p>
  </div>

  <p>
    Ap√≥s a captura, utilizamos o script <code>L2_cal.py</code> com as imagens obtidas para realizar a calibra√ß√£o da webcam. O processo retornou os seguintes par√¢metros:
  </p>

  <h4>Matriz Intr√≠nseca K</h4>
  <table style="border-collapse: collapse;">
    <tr>
      <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">691.4759</td>
      <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">0</td>
      <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">331.3271</td>
    </tr>
    <tr>
      <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">0</td>
      <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">688.6196</td>
      <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">268.3314</td>
    </tr>
    <tr>
      <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">0</td>
      <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">0</td>
      <td style="border: 1px solid #333; padding: 8px 12px; text-align: center;">1</td>
    </tr>
  </table>

  <h4>Coeficientes de Distor√ß√£o (vetor <code>dist</code>)</h4>
  <p><strong>D =</strong> [0.0428, ‚àí0.1733, 0.0015, 0.0007, 0.3550]</p>

  <h4>Par√¢metros Extr√≠nsecos</h4>
  <p>
    Como na Parte A, a calibra√ß√£o gerou um conjunto de vetores de rota√ß√£o (<code>rvecs</code>) e transla√ß√£o (<code>tvecs</code>) para cada imagem capturada. 
    Esses par√¢metros descrevem a posi√ß√£o e orienta√ß√£o da c√¢mera em rela√ß√£o ao plano do tabuleiro em cada foto.
  </p>

  <div class="button-group">
    <button onclick="toggleSection('extrinsecos_webcam')">Mostrar par√¢metros extr√≠nsecos (R e t) ‚Äì Webcam</button>
  </div>
  <div id="extrinsecos_webcam" class="relatorio-section" style="display: none;">
    <code><pre>
  rvecs (exemplo):
  [ 0.33699863], [0.66226067], [1.68536465]
  [-0.67689141], [0.93845312], [1.36255251]

  tvecs (exemplo):
  [3.40036748], [-1.77216632], [15.51420698]
  [0.77770731], [-2.94733489], [15.38510949]
    </pre></code>
  </div>

  <h4>An√°lise dos Par√¢metros</h4>
  <ul>
    <li><strong>Focal Length:</strong> f<sub>x</sub> = 691.48 px, f<sub>y</sub> = 688.62 px ‚Äì indicando lentes com dist√¢ncias focais pr√≥ximas nos dois eixos.</li>
    <li><strong>Aspect Ratio:</strong> f<sub>x</sub> / f<sub>y</sub> = 1.004 ‚Äì muito pr√≥ximo de 1, o que √© ideal.</li>
    <li><strong>Skew:</strong> 0 ‚Äì indicando que os eixos x e y da imagem s√£o ortogonais, como esperado.</li>
    <li><strong>Ponto Principal:</strong> (c<sub>x</sub>, c<sub>y</sub>) = (331.33, 268.33) ‚Äì pr√≥ximo ao centro da imagem.</li>
  </ul>

  <h4>Compara√ß√£o com Parte A</h4>
  <p>
    Comparando com a calibra√ß√£o realizada na Parte A (imagens fornecidas), observamos que:
  </p>
  <ul>
    <li>Os valores de focal length s√£o maiores na webcam utilizada nesta etapa.</li>
    <li>O ponto principal deslocou-se levemente, o que √© comum devido √† diferen√ßa de resolu√ß√£o entre c√¢meras.</li>
    <li>Os coeficientes de distor√ß√£o indicam uma lente com menor distor√ß√£o radial em rela√ß√£o √† c√¢mera da Parte A.</li>
  </ul>

  <h4>Por que temos v√°rios vetores R e t?</h4>
  <p>
    O algoritmo de calibra√ß√£o estima um par de par√¢metros extr√≠nsecos (rota√ß√£o e transla√ß√£o) para <strong>cada imagem</strong> capturada, 
    pois em cada uma delas a c√¢mera est√° posicionada em um local e orienta√ß√£o diferentes em rela√ß√£o ao tabuleiro. 
    Os vetores <strong>r</strong> e <strong>t</strong> descrevem a transforma√ß√£o necess√°ria para levar os pontos do mundo real (tabuleiro) at√© o sistema de coordenadas da c√¢mera.
  </p>



  <p>Na sequ√™ncia deste laborat√≥rio, ap√≥s a equipe ter realizado a calibra√ß√£o da webcam com a captura de suas pr√≥prias imagens de calibra√ß√£o, a pr√≥xima etapa foi repetir o mesmo procedimento mas dessa vez utilizando uma outra c√¢mera disponibilizada pelo professor. Ou seja, com a nova c√¢mera, a equipe realizou a captura de diferentes fotos com o c√≥digo j√° apresentado anteriormente e obteve novos par√¢metros como resultados, apresentados abaixo:
  </p>

  <h2>An√°lise e Discuss√£o</h2>
  <p>
      
  </p>
  <h2>Conclus√µes</h2>
  <p>
    
  </p>
    <div class="referencias">
    <h2>Refer√™ncias</h2>
    <ul>
      <li><a href="" target="_blank">OpenCV Imgcodecs Reference</a></li>
    </ul>
  </div>

</div>
